name: ubuntu-autopkgtest-janitor
type: charm
summary: A charm for performing maintenance for the autopkgtest infrastructure
description: A charm for performing maintenance for the autopkgtest infrastructure.
links:
  issues:
    - https://github.com/canonical/ubuntu-autopkgtest-operators/issues
  source:
    - https://github.com/canonical/ubuntu-autopkgtest-operators

base: ubuntu@24.04
platforms:
  amd64:
    build-on: [amd64]
    build-for: [amd64]

charm-libs:
  - lib: operator_libs_linux.systemd
    version: "1"

parts:
  charm:
    plugin: charm
    source: .
  systemd-units:
    plugin: dump
    source: .
    stage:
      - units/*

actions:
  add-remote:
    description: Add remote to run maintenance tasks on.
    params:
      arch:
        type: string
        description: Architecture of the remote.
        enum: [amd64, amd64v3, i386, arm64, armhf, s390x, ppc64el, riscv64]
      token:
        type: string
        description: LXD client token to connect to a remote.
  remove-remote:
    description: Remove a remote from the janitor.
    params:
      arch:
        type: string
        description: Architecture of the remote.
        enum: [amd64, amd64v3, i386, arm64, armhf, s390x, ppc64el, riscv64]
  rebuild-all-images:
    description: Trigger rebuild of all the images

config:
  options:
    autopkgtest-git-branch:
      type: string
      description: salsa.debian.org/ubuntu-ci-team/autopkgtest branch to clone
      default: ubuntu/staging
    releases:
      type: string
      description: Space-separated of releases to build images for
      default: resolute
    mirror:
      type: string
      description: Ubuntu mirror to use
      default: http://archive.ubuntu.com/ubuntu/
    max-containers:
      type: int
      description: Max number of containers per remote
      default: 50
    max-virtual-machines:
      type: int
      description: Max number of virtual machines per remote
      default: 20
