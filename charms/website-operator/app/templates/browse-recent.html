{% extends "browse-layout.html" %}
{% import "macros.html" as macros %}

{% macro display_test_info(results) -%}
  <table class="table">
    <tr>
      <td>
        <b>Package</b>
      </td>
      <td>
        <b>Release</b>
      </td>
      <td>
        <b>Arch</b>
      </td>
      {{ macros.set_up_results_table() }}
    </tr>
    {% for row in results %}
      <tr {% if row["code"] in ["running", "queued"] %}class="unfinished"{% endif %}>
        {% set package = row["package"] %}
        {% set release = row["release"] %}
        {% set arch = row["arch"] %}
        <td>{{ package }}</td>
        <td>{{ release }}</td>
        <td>{{ arch }}</td>
        {{ macros.results_table_core(row["version"], row["triggers"], row["additional_params"], row["human_date"], row["human_sec"], row["requester"], row["code"], row["url"], row["show_retry"], row["all_proposed"], row["uuid"], package, release, arch) }}
      </tr>
    {% endfor %}
  </table>
{%- endmacro %}

{% block content %}
  <h1 class="page-header" id="user-home">
    Recent test results
    {% if arch or release %}
      for {{ release }}
      {% if arch and release %}/{% endif %}
      {{ arch }}
    {% endif %}
  </h1>

  <form action="" method="get">
    <label for="limit">Results per page:</label>
    <select name="limit" id="limit">
      <option value="10" {% if limit == 10 %}selected="selected"{% endif %}>10</option>
      <option value="100" {% if limit == 100 %}selected="selected"{% endif %}>100</option>
      <option value="500" {% if limit == 500 %}selected="selected"{% endif %}>500</option>
      <option value="1000" {% if limit == 1000 %}selected="selected"{% endif %}>1000</option>
      <option value="5000" {% if limit == 5000 %}selected="selected"{% endif %}>5000</option>
      <option value="10000" {% if limit == 10000 %}selected="selected"{% endif %}>10000</option>
    </select>
    <label for="arch">Architecture:</label>
    <select name="arch" id="arch">
      <option value=""></option>
      {% for a in all_arches|sort() %}
        <option value="{{ a }}" {% if arch == a %}selected="selected"{% endif %}>{{ a }}</option>
      {% endfor %}
    </select>
    <label for="release">Release:</label>
    <select name="release" id="release">
      <option value=""></option>
      {% for r in releases|reverse() %}
        <option value="{{ r }}" {% if release == r %}selected="selected"{% endif %}>{{ r }}</option>
      {% endfor %}
    </select>
  </input>
  <input type="submit" value="Show">
</form>

{% if recent_test_results %}
  <p>Results {{ offset }} to {{ offset + limit }}</p>
  {{ display_test_info(recent_test_results) }}
{% else %}
  <p>Looks like there's no results.</p>
{% endif %}

<nav class="page-links links">
  {% if offset != 0 %}
    <a href="?offset={{ offset - limit }}&limit={{ limit }}&arch={{ arch }}&release={{ release }}">Previous page</a>
  {% endif %}
  <a href="?offset={{ offset + limit }}&limit={{ limit }}&arch={{ arch }}&release={{ release }}">Next page</a>
  <br>
  <a href="?limit=10000&arch={{ arch }}&release={{ release }}">Show more results</a>
</nav>

{% endblock content %}
